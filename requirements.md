# 12306 火车票订票系统需求文档

## 1. 总览
- 系统类型：Web 应用；目标用户：铁路乘客、系统管理员。
- 登录要求：预订与订单管理需登录；查询与筛选可不登录。
- 主要模块：登录与注册、个人中心与乘车人管理、车票查询与筛选、预订流程、订单管理、异常与容错、术语与数据规则。

## 2. 用户登录与注册
### 2.1 登录页面
- 支持“账号登录/扫码登录”切换。
- 账号登录输入：用户名/手机号/邮箱、密码；含“立即登录”“忘记密码”“立即注册”。
- Scenario: 有效凭据登录
  - Given 用户位于登录页面并输入正确凭据
  - When 点击“立即登录”
  - Then 验证成功并跳转首页或个人中心。
- Scenario: 无效凭据登录
  - Given 用户位于登录页面
  - When 输入错误凭据后登录
  - Then 提示“用户名或密码错误”。

### 2.2 注册页面
- 表单字段：用户名、登录密码、确认密码、证件类型、姓名、证件号码、旅客类型、手机号码；需勾选服务条款；“注册”按钮。
- Scenario: 成功注册
  - Given 用户填写有效信息并同意条款
  - When 点击“注册”
  - Then 创建账号并提示“注册成功”，可引导登录。
- Scenario: 注册信息无效
  - When 信息存在格式错误或密码不一致
  - Then 在对应字段提示错误。

## 3. 个人中心与乘车人管理
### 3.1 个人中心
- 侧边栏：个人信息、乘车人管理、订单管理。
- 主区域展示：用户名、姓名、证件类型及号码、核验状态、联系手机、邮箱、旅客类型；支持编辑部分联系信息。

### 3.2 乘车人管理
- 列表字段：序号、姓名、证件类型/号码、手机号、核验状态；操作：添加、编辑、删除、批量删除；支持按姓名/证件号搜索。
- 数量上限：每账号最多添加15名常用乘车人。
- 表单字段校验：
  - 姓名（2-30字符，中文/英文）
  - 证件类型（下拉）与证件号码（按类型校验）
  - 手机号码（11位）
  - 旅客类型（成人/儿童/学生）
- Scenario: 查看/添加/编辑/删除/批量删除
  - 添加：填写有效信息并保存，列表刷新。
  - 编辑：修改信息后保存，列表刷新。
  - 删除：需确认并检查是否存在未完成订单；有则不可删除。
  - 批量删除：逐一检查可删除性，输出结果报告并刷新列表。

## 4. 车票查询与筛选
### 4.1 页面结构
- 顶部：出发地、目的地、出发日期；“交换”按钮；“查询车票”按钮。
- 中部：筛选栏（列车类型 G/C/D/Z/T/K；座位类型 商务/一等/二等/软卧/硬卧/硬座）。
- 底部：车次结果展示区（显示有票与无票；全席位余票为0时标注“无可预订席位”，“预订”按钮灰色不可点）。

### 4.2 基础交互
- 出发地/目的地为系统预置车站下拉，且不可相同。
- 出发日期为日历输入，范围：当前日起14天内。
- 交换出发地与目的地：点击后两者值交换，日期不变。
- 发起查询：校验条件有效后查询并展示车次信息（车次号、出发/到达站与时间、历时、各席位余票与票价）。

### 4.3 筛选交互
- 按列车类型筛选；无结果提示“无符合条件的列车班次”。
- 按座位类型筛选；余票为0仍显示。
- 组合筛选：同时按列车类型与座位类型；无结果提示“暂无符合条件的列车班次”。

### 4.4 展示区交互
- 查看详情：展开经停站、到达时间与历时。
- 点击“预订”：
  - 已登录：跳转“车票预订页面”，传递车次与区间信息（如“G80 广州南 → 北京西”）。
  - 未登录：跳转“登录页面”。
- 重新查询：修改条件后再次查询并刷新结果。

## 5. 车票预订流程
- 背景：用户需登录；流程包含选择乘车人、票种、座位等级、提交订单与二次确认。
- Scenario: 进入预订页面
  - Given 用户在车次列表
  - When 点击“预订”
  - Then 跳转预订页面并显示选中车次信息（车次号、出发/到达站、出发/到达时间）。
- Scenario: 选择乘车人
  - Given 用户已添加常用乘车人
  - When 在列表中选择乘车人（最多5人）
  - Then 显示已选择的乘车人（姓名、证件类型、证件号部分隐藏）。
- Scenario: 选择票种与座位等级
  - 票种：成人/儿童/学生；座位等级：商务/一等/二等；根据余票显示可用性；实时计算总价。
- Scenario: 提交订单与二次确认
  - 验证必填信息完整并检查余票。
  - 显示二次确认弹窗：车次、乘车人、座位、票价与总价。
  - 用户“确认预订”后生成订单并跳转支付；“取消”返回预订页面。

### 5.1 异常与防护（预订）
- 余票不足：提示并刷新余票，允许重新选择座位或车次。
- 网络异常：提示并保留已选信息，提供“重试”。
- 订单提交超时：提示“订单处理中”，后台继续处理；成功自动跳转支付，失败给出原因。
- 重复提交防护：忽略重复点击并提示“订单处理中，请勿重复提交”。

## 6. 订单管理
- 订单分类：未完成订单（预订未支付）、未出行订单（已支付未出行）、历史订单（已出行）。
- 进入订单中心：默认显示“未完成订单”。

### 6.1 列表与操作
- 未完成订单：倒序；字段含订单号、车次、出行日期、乘客、座位、订单金额、剩余支付时间；操作“立即支付”“取消订单”。
- 未出行订单：按乘车日期正序；显示座位号与“已支付”；操作“退票”“改签”（条件符合）。
- 历史订单：乘车日期倒序；操作“查看详情”。

### 6.2 查询与详情
- 查询：支持按时间区间（乘车/订票）与精确查询（订单号/车次号/乘客姓名），适用于三类订单；无结果显示友好提示与清空条件入口。
- 订单详情：行程（出发/到达站与时间）、所有乘客信息（姓名、证件类型/号码、票种）、座位（车厢号/座位号/座位类型）、支付信息（方式/时间/发票）、订单操作历史。

### 6.3 支付、取消与退票
- 支付订单页面：显示完整订单信息，提供“取消订单”“一键支付”。
- 取消订单：确认后更新为“已取消”，释放座位资源，返回订单列表。
- 一键支付：处理支付并更新为“已支付”，分配座位号，提示成功，订单状态为“已出票”。
- 退票申请：显示退票费用与退款金额；确认后处理并更新为“已退票”，退款按原支付方式返还。

### 6.4 异常（订单管理）
- 订单查询无结果：提示并提供查询建议与“清空条件”。
- 支付超时：超过时限（如20分钟）自动取消订单并释放座位，通知用户。
- 支付失败：显示具体原因（如网络超时），订单保持“待支付”，提供“重新支付”。
- 退票条件不符：提示具体原因（如开车前2小时内不支持）；提供客服联系方式与规则指引。
- 订单数据加载失败：提示并支持“重新加载”，多次失败建议联系客服；记录错误日志。
- 并发冲突：以最后一次操作为准，提示冲突并自动刷新；不可逆操作提示确认。

## 7. 术语与数据规则（统一）
- 列车类型：G高铁、D动车、C城际、Z直达、T特快、K快速。
- 座位类型：商务座、一等座、二等座、软卧、硬卧、硬座。
- 票种：成人票、儿童票、学生票。
- 查询日期范围：当前日起14天内。
- 乘车人上限：每账号最多15人；单次预订最多选择5人。
- 余票为0的处理：班次仍可展示，标注不可预订或禁用按钮。
- 初始化数据：初始化的时候向数据库插入一定量的示例数据（之后的测试案例都使用示例数据进行）。
