# 12306铁路订票系统 - 订单管理与乘车人管理功能需求规格说明书

## 项目概述

本文档基于中国铁路12306官方网站的功能分析，详细描述了订单管理、预定流程和乘车人管理三大核心功能模块的需求规格。文档采用Gherkin语法编写，确保需求的可测试性和可实现性。

**目标用户**: 铁路乘客、系统管理员
**系统类型**: Web应用系统
**参考网站**: https://www.12306.cn/ <mcreference link="https://www.12306.cn/" index="0">0</mcreference>

---

## Feature: 车票预定系统

作为一个铁路乘客，我希望能够从车次列表页面进入预定流程，选择乘车人并确认订单信息，以便我能够顺利完成车票预定。

### 背景信息
- 预定系统是购票流程的核心环节
- 用户需要登录后才能进行车票预定
- 预定流程包括：选择乘车人、确认票种、选择座位等级、提交订单

### Scenario: 进入预定页面
    Given 用户已成功登录12306系统
    And 用户在车次列表页面
    When 用户点击具体车次的"预订"按钮
    Then 系统跳转到预定页面
    And 页面显示选中的车次信息：
        | 字段 | 描述 |
        | 车次号 | 选中的列车车次 |
        | 出发站 | 出发车站名称 |
        | 到达站 | 到达车站名称 |
        | 出发时间 | 列车出发时间 |
        | 到达时间 | 列车到达时间 |

### Scenario: 选择乘车人
    Given 用户在预定页面
    And 用户已添加常用乘车人
    When 用户在乘车人列表中选择乘车人
    Then 系统显示已选择的乘车人信息
    And 用户可以选择多个乘车人（最多5人）
    And 每个乘车人显示以下信息：
        | 字段 | 描述 |
        | 姓名 | 乘车人真实姓名 |
        | 证件类型 | 身份证/护照等 |
        | 证件号码 | 证件号码（部分隐藏） |

### Scenario: 选择票种和座位等级
    Given 用户已选择乘车人
    When 用户为每个乘车人选择票种和座位等级
    Then 系统提供以下选项：
        | 票种选项 | 适用条件 |
        | 成人票 | 14岁以上乘客 |
        | 儿童票 | 6-14岁儿童 |
        | 学生票 | 持有学生证的学生 |
    And 系统提供座位等级选择：
        | 座位等级 | 价格 | 可用性 |
        | 商务座 | 最高价格 | 根据余票显示 |
        | 一等座 | 中等价格 | 根据余票显示 |
        | 二等座 | 基础价格 | 根据余票显示 |
    And 系统实时计算总票价

### Scenario: 提交订单
    Given 用户已完成乘车人和票种选择
    And 所有必填信息已填写完整
    When 用户点击"提交订单"按钮
    Then 系统验证订单信息的完整性
    And 系统检查座位余票情况
    And 系统显示订单二次确认弹窗

### Scenario: 订单二次确认
    Given 用户已提交订单
    When 系统显示二次确认弹窗
    Then 弹窗显示完整的订单信息：
        | 确认信息 | 内容 |
        | 车次信息 | 车次号、出发到达站、时间 |
        | 乘车人信息 | 所有乘车人姓名、证件号 |
        | 座位信息 | 座位等级和数量 |
        | 票价信息 | 各票种价格和总价 |
    And 用户可以选择"确认预订"或"取消"
    And 点击"确认预订"后系统生成订单并分配订单号跳转到支付页面
    And 点击"取消"后返回预定页面

### 异常情况处理场景

### Scenario: 余票不足异常处理
    Given 用户已完成乘车人和票种选择
    When 用户点击"提交订单"按钮
    And 系统检查座位余票情况发现余票不足
    Then 系统显示余票不足提示："抱歉，您选择的座位等级余票不足，请选择其他座位等级或车次"
    And 系统自动刷新当前车次的余票信息
    And 用户可以选择其他可用的座位等级
    And 用户可以返回车次列表选择其他车次

### Scenario: 网络异常处理
    Given 用户在预定流程中的任意步骤
    When 发生网络连接异常或超时
    Then 系统显示网络异常提示："网络连接异常，请检查网络后重试"
    And 系统保存用户当前填写的信息（如已选择的乘车人）
    And 提供"重试"按钮供用户重新提交
    And 用户点击重试后系统恢复之前的填写状态


### Scenario: 订单提交超时处理
    Given 用户点击"提交订单"按钮
    When 系统处理订单超过30秒未响应
    Then 系统显示处理超时提示："订单处理中，请稍候..."
    And 系统在后台继续处理订单
    And 如果处理成功，自动跳转到支付页面
    And 如果处理失败，显示失败原因并允许重新提交

### Scenario: 重复提交订单防护
    Given 用户已点击"提交订单"按钮
    And 订单正在处理中
    When 用户再次点击"提交订单"按钮
    Then 系统忽略重复点击
    And 显示"订单处理中，请勿重复提交"提示
    And 保持当前处理状态不变

---

## Feature: 订单管理系统

作为一个铁路乘客，我希望能够管理我的火车票订单，包括查看、支付、取消和退票等操作，以便我能够灵活地安排我的出行计划。

### 背景信息
- 订单管理是12306系统的核心功能之一
- 用户需要登录后才能访问订单管理功能
- 订单分为三类：未完成订单（预订而未支付的）、未出行订单（已支付但未出行的）、历史订单（已完成出行的）
- 每类订单提供不同的查询方式和操作功能

### Scenario: 进入订单中心
    Given 用户已成功登录12306系统
    And 用户在"我的12306"页面
    When 用户点击"订单中心"菜单
    Then 系统显示订单中心页面
    And 页面顶部显示三个订单分类标签：
        | 订单分类 | 描述 |
        | 未完成订单 | 预订而未支付的订单 |
        | 未出行订单 | 已支付但未出行的订单 |
        | 历史订单 | 已完成出行的订单 |
    And 默认显示"未完成订单"标签页内容

### Scenario: 查看未完成订单列表
    Given 用户在订单中心页面
    And 用户选择"未完成订单"标签
    When 系统加载未完成订单数据
    Then 系统显示所有预订而未支付的订单
    And 订单列表按订票时间倒序排列
    And 每个订单显示以下信息：
        | 字段 | 描述 |
        | 订单号 | 唯一标识订单的编号 |
        | 车次信息 | 车次号、出发站、到达站 |
        | 出行日期 | 乘车日期和时间 |
        | 乘客信息 | 乘客姓名和身份证号 |
        | 座位信息 | 座位类型 |
        | 订单金额 | 票价总额 |
        | 剩余支付时间 | 距离订单失效的倒计时 |
    And 每个订单提供"立即支付"和"取消订单"操作按钮

### Scenario: 查看未出行订单列表
    Given 用户在订单中心页面
    And 用户选择"未出行订单"标签
    When 系统加载未出行订单数据
    Then 系统显示所有已支付但未出行的订单
    And 订单列表按乘车日期正序排列
    And 每个订单显示以下信息：
        | 字段 | 描述 |
        | 订单号 | 唯一标识订单的编号 |
        | 车次信息 | 车次号、出发站、到达站 |
        | 出行日期 | 乘车日期和时间 |
        | 乘客信息 | 乘客姓名和身份证号 |
        | 座位信息 | 座位类型和座位号 |
        | 订单状态 | 已支付 |
        | 订单金额 | 票价总额 |
    And 每个订单提供"退票"和"改签"操作按钮（如果符合条件）

### Scenario: 查看历史订单列表
    Given 用户在订单中心页面
    And 用户选择"历史订单"标签
    When 系统加载历史订单数据
    Then 系统显示所有已完成出行的订单
    And 订单列表按乘车日期倒序排列
    And 每个订单显示以下信息：
        | 字段 | 描述 |
        | 订单号 | 唯一标识订单的编号 |
        | 车次信息 | 车次号、出发站、到达站 |
        | 出行日期 | 乘车日期和时间 |
        | 乘客信息 | 乘客姓名和身份证号 |
        | 座位信息 | 座位类型和座位号 |
        | 订单状态 | 已完成/已退票 |
        | 订单金额 | 票价总额 |
    And 每个订单提供"查看详情"操作按钮

### Scenario: 历史订单按乘车日期查询
    Given 用户在"历史订单"标签页
    When 用户选择"按乘车日期查询"选项
    Then 系统显示乘车日期查询界面
    And 提供以下查询选项：
        | 查询方式 | 描述 |
        | 时间区间选择 | 选择乘车开始日期和结束日期 |
        | 快捷时间选择 | 最近一个月/最近三个月/最近一年/自定义时间 |
    And 用户选择时间区间后点击"查询"
    And 系统显示该时间段内乘车的历史订单
    And 如果没有符合条件的订单，显示"该时间段内暂无订单"提示

### Scenario: 历史订单按订单号/车次/姓名查询
    Given 用户在"历史订单"标签页
    When 用户选择"精确查询"选项
    Then 系统显示精确查询界面
    And 提供以下查询字段：
        | 查询字段 | 输入要求 |
        | 订单号 | 输入完整或部分订单号 |
        | 车次号 | 输入车次号（如G123） |
        | 乘客姓名 | 输入乘客真实姓名 |
    And 用户可以单独使用任一字段或组合使用多个字段
    And 用户输入查询条件后点击"查询"
    And 系统显示符合条件的历史订单
    And 如果没有符合条件的订单，显示"未找到相关订单"提示

### Scenario: 未完成订单按订单号/车次/姓名查询
    Given 用户在"未完成订单"标签页
    When 用户选择"精确查询"选项
    Then 系统显示精确查询界面
    And 提供以下查询字段：
        | 查询字段 | 输入要求 |
        | 订单号 | 输入完整或部分订单号 |
        | 车次号 | 输入车次号（如G123） |
        | 乘客姓名 | 输入乘客真实姓名 |
    And 用户可以单独使用任一字段或组合使用多个字段
    And 用户输入查询条件后点击"查询"
    And 系统显示符合条件的未完成订单
    And 如果没有符合条件的订单，显示"未找到相关订单"提示

### Scenario: 未出行订单按订票日期查询
    Given 用户在"未出行订单"标签页
    When 用户选择"按订票日期查询"选项
    Then 系统显示订票日期查询界面
    And 提供以下查询选项：
        | 查询方式 | 描述 |
        | 时间区间选择 | 选择订票开始日期和结束日期 |
    And 用户选择时间区间后点击"查询"
    And 系统显示该时间段内订票的未出行订单
    And 如果没有符合条件的订单，显示"该时间段内暂无订单"提示

### Scenario: 未出行订单按乘车日期查询
    Given 用户在"未出行订单"标签页
    When 用户选择"按乘车日期查询"选项
    Then 系统显示乘车日期查询界面
    And 提供以下查询选项：
        | 查询方式 | 描述 |
        | 时间区间选择 | 选择乘车开始日期和结束日期 |
    And 用户选择时间区间后点击"查询"
    And 系统显示该时间段内乘车的未出行订单
    And 如果没有符合条件的订单，显示"该时间段内暂无订单"提示

### Scenario: 未出行订单按订单号/车次/姓名查询
    Given 用户在"未出行订单"标签页
    When 用户选择"精确查询"选项
    Then 系统显示精确查询界面
    And 提供以下查询字段：
        | 查询字段 | 输入要求 |
        | 订单号 | 输入完整或部分订单号 |
        | 车次号 | 输入车次号（如G123） |
        | 乘客姓名 | 输入乘客真实姓名 |
    And 用户可以单独使用任一字段或组合使用多个字段
    And 用户输入查询条件后点击"查询"
    And 系统显示符合条件的未出行订单
    And 如果没有符合条件的订单，显示"未找到相关订单"提示

### Scenario: 查看订单详情
    Given 用户在订单列表页面
    When 用户点击某个订单的"详情"按钮
    Then 系统显示该订单的详细信息页面
    And 详情页面包含以下信息：
        - 完整的行程信息（出发站、到达站、出发时间、到达时间）
        - 所有乘客的详细信息（姓名、证件类型、证件号码、票种）
        - 座位详细信息（车厢号、座位号、座位类型）
        - 支付信息（支付方式、支付时间、发票信息）
        - 订单操作历史记录

### Scenario: 支付订单页面
    Given 用户有一个状态为"待支付"的订单
    And 订单在支付时限内（通常为30分钟）
    When 用户点击"立即支付"按钮或从预定流程跳转
    Then 系统显示支付订单页面
    And 页面显示完整的订单信息：
        | 显示信息 | 内容 |
        | 车次信息 | 车次号、出发到达站、时间 |
        | 乘车人信息 | 所有乘车人详细信息 |
        | 票价信息 | 各票种价格和总价 |
        | 座位信息 | 座位等级和座位号 |
    And 页面提供两个操作选项："取消订单"和"一键支付"

### Scenario: 取消订单
    Given 用户在支付订单页面
    When 用户点击"取消订单"按钮
    Then 系统显示取消确认对话框
    And 提示"取消后订单将无法恢复，确定要取消吗？"
    And 用户点击"确定"后
    And 系统将订单状态更新为"已取消"
    And 释放对应的座位资源
    And 返回订单列表页面

### Scenario: 一键支付
    Given 用户在支付订单页面
    When 用户点击"一键支付"按钮
    Then 系统处理支付请求
    And 系统更新订单状态为"已支付"
    And 系统分配具体座位号
    And 显示支付成功提示
    And 订单状态更新为"已出票"

### Scenario: 订单退票申请
    Given 用户有一个可退票的订单
    And 该订单符合退票条件
    When 用户点击"退票"按钮
    Then 系统显示退票确认页面
    And 显示退票费用和退款金额
    And 用户确认退票信息
    And 系统处理退票请求
    And 订单状态更新为"已退票"
    And 退款按原支付方式返还

### 异常情况处理场景

### Scenario: 订单查询无结果处理
    Given 用户在任一订单标签页进行查询
    When 查询条件没有匹配到任何订单
    Then 系统显示友好的无结果提示："未找到符合条件的订单"
    And 提供查询建议："请检查查询条件或尝试扩大查询范围"
    And 显示"清空条件"按钮供用户重置查询
    And 显示常用查询快捷入口

### Scenario: 支付超时处理
    Given 用户有一个待支付订单
    When 订单超过支付时限（20分钟）
    Then 系统自动将订单状态更新为"已取消"
    And 释放对应的座位资源
    And 向用户发送订单取消通知
    And 用户再次访问该订单时显示"订单已超时取消"

### Scenario: 支付失败处理
    Given 用户点击"一键支付"按钮
    When 支付过程中发生失败
    Then 系统显示具体的支付失败原因：
        | 失败原因 | 处理方式 |
        | 网络超时 | "支付网络超时，请稍后重试" |
    And 保持订单状态为"待支付"
    And 提供"重新支付"按钮

### Scenario: 退票条件不符处理
    Given 用户点击某个订单的"退票"按钮
    When 该订单不符合退票条件
    Then 系统显示不可退票的具体原因：
        | 不可退票原因 | 提示信息 |
        | 开车前2小时内 | "开车前2小时内不支持退票" |
        | 已使用车票 | "该车票已使用，无法退票" |
        | 特殊票种限制 | "该票种不支持退票，详情请咨询客服" |
    And 提供客服联系方式
    And 建议用户查看退票规则

### Scenario: 订单数据加载失败
    Given 用户访问订单中心
    When 系统无法加载订单数据
    Then 系统显示加载失败提示："订单数据加载失败，请稍后重试"
    And 提供"重新加载"按钮
    And 如果多次重试失败，提示用户联系客服
    And 记录错误日志供技术人员排查

### Scenario: 并发操作冲突处理
    Given 用户同时在多个设备或浏览器标签页操作同一订单
    When 发生并发操作冲突
    Then 系统以最后一次操作为准
    And 向用户显示冲突提示："检测到该订单在其他地方被操作，页面将自动刷新"
    And 自动刷新页面显示最新的订单状态
    And 如果操作不可逆（如支付），提示用户确认操作结果

---

## Feature: 乘车人管理系统

作为一个铁路乘客，我希望能够管理我的常用乘车人信息，包括添加、编辑、删除乘车人信息，以便我能够快速为自己和他人购买火车票。

### 背景信息
- 乘车人管理是购票的前置功能
- 每个用户最多可以添加15个常用乘车人
- 支持成人票、儿童票、学生票等不同票种

### Scenario: 查看乘车人列表
    Given 用户已成功登录12306系统
    And 用户在"我的12306"页面
    When 用户点击"乘车人"菜单
    Then 系统显示用户的所有常用乘车人列表
    And 乘车人列表显示以下信息：
        | 字段 | 描述 |
        | 姓名 | 乘车人真实姓名 |
        | 证件类型 | 身份证/护照/港澳通行证等 |
        | 证件号码 | 证件号码（部分隐藏） |
        | 手机号码 | 联系电话（部分隐藏） |
        | 旅客类型 | 成人/儿童/学生 |
    And 页面提供"添加乘车人"和"批量删除"按钮

### Scenario: 添加新乘车人信息
    Given 用户在乘车人页面
    And 用户的常用乘车人数量少于15个
    When 用户点击"添加乘车人"按钮
    Then 系统显示添加乘车人表单
    And 表单包含以下必填字段：
        | 字段名 | 验证规则 |
        | 姓名 | 2-30个字符，支持中文和英文 |
        | 证件类型 | 从下拉列表中选择 |
        | 证件号码 | 根据证件类型验证格式 |
        | 手机号码 | 11位数字，符合手机号格式 |
        | 旅客类型 | 成人/儿童/学生 |
    And 用户填写完整信息后点击"保存"
    And 系统验证信息格式的正确性
    And 保存成功后返回乘车人列表

### Scenario: 编辑乘车人信息
    Given 用户在乘车人页面
    And 存在已添加的乘车人信息
    When 用户点击某个乘车人的"编辑"按钮
    Then 系统显示编辑乘车人信息表单
    And 表单预填充当前乘车人信息
    And 用户可以修改所有信息字段
    And 用户修改信息后点击"保存"
    And 系统验证修改后的信息格式
    And 保存成功后返回乘车人列表

### Scenario: 删除单个乘车人信息
    Given 用户在乘车人页面
    And 存在已添加的乘车人信息
    When 用户点击某个乘车人的"删除"按钮
    Then 系统显示删除确认对话框
    And 提示"删除后该乘车人信息将无法恢复，确定要删除吗？"
    And 用户点击"确定"后
    And 系统检查该乘车人是否有未完成的订单
    And 如果有未完成订单，提示无法删除
    And 如果没有未完成订单，执行删除操作
    And 删除成功后刷新乘车人列表

### Scenario: 批量删除乘车人信息
    Given 用户在乘车人页面
    And 存在多个已添加的乘车人信息
    When 用户选择多个乘车人（通过复选框）
    And 用户点击"批量删除"按钮
    Then 系统显示批量删除确认对话框
    And 提示"确定要删除选中的X个乘车人吗？删除后将无法恢复"
    And 用户点击"确定"后
    And 系统逐一检查每个选中乘车人是否有未完成订单
    And 显示检查结果：
        | 检查结果 | 处理方式 |
        | 可删除 | 执行删除操作 |
        | 有未完成订单 | 跳过删除，显示提示信息 |
    And 显示批量删除结果报告
    And 刷新乘车人列表

### 异常情况处理场景

### Scenario: 乘车人数量达到上限
    Given 用户已添加15个常用乘车人
    When 用户点击"添加乘车人"按钮
    Then 系统显示数量限制提示："您已达到常用乘车人数量上限（15人）"
    And 提示用户删除不常用的乘车人后再添加
    And 提供"管理现有乘车人"快捷入口
    And 禁用"添加乘车人"按钮

### Scenario: 身份证号重复验证
    Given 用户在添加或编辑乘车人时
    When 输入的身份证号与已有乘车人重复
    Then 系统显示重复提示："该身份证号已存在，请检查是否重复添加"
    And 高亮显示重复的身份证号字段
    And 提供"查看已有乘车人"链接
    And 阻止保存操作直到修正

### Scenario: 网络异常导致保存失败
    Given 用户填写完乘车人信息并点击"保存"
    When 发生网络异常导致保存失败
    Then 系统显示保存失败提示："网络异常，保存失败，请重试"
    And 保留用户已填写的信息不丢失
    And 提供"重新保存"按钮
    And 如果多次重试失败，建议用户稍后再试

### Scenario: 删除乘车人时存在关联订单
    Given 用户尝试删除某个乘车人
    When 该乘车人存在未完成的订单
    Then 系统显示无法删除提示："该乘车人存在未完成订单，无法删除"
    And 显示关联的订单信息：
        | 订单信息 | 内容 |
        | 订单号 | 具体订单编号 |
        | 车次 | 相关车次信息 |
        | 出行日期 | 乘车日期 |
        | 订单状态 | 当前状态 |
    And 建议用户处理完相关订单后再删除

### Scenario: 批量操作部分失败处理
    Given 用户选择多个乘车人进行批量删除
    When 部分乘车人删除成功，部分失败
    Then 系统显示详细的操作结果：
        | 操作结果 | 数量 | 详细信息 |
        | 删除成功 | X人 | 显示成功删除的乘车人姓名 |
        | 删除失败 | Y人 | 显示失败原因（如有未完成订单） |
    And 提供失败项的处理建议
    And 刷新乘车人列表显示最新状态

### Scenario: 表单验证错误处理
    Given 用户在添加或编辑乘车人表单中
    When 用户输入的信息格式不正确
    Then 系统实时显示具体的错误提示：
        | 字段 | 错误类型 | 提示信息 |
        | 姓名 | 格式错误 | "姓名只能包含中文和英文字符" |
        | 手机号 | 格式错误 | "请输入正确的11位手机号码" |
        | 身份证号 | 格式错误 | "请输入正确的18位身份证号码" |
    And 错误字段用红色边框标识
    And 禁用"保存"按钮直到所有错误修正
    And 提供格式示例供用户参考
